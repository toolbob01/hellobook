<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hellobook.mapper.PostMapper">

	<sql id="criteria">
	  <trim prefix="(" suffix=") and " prefixOverrides="OR">
	    <foreach collection="typeArr" item="type">
		  <trim prefix="OR">
			<choose>
				<when test="type == 'T'.toString()">
					title like '%'||#{keyword}||'%'
				</when>
				<when test="type == 'C'.toString()">
					content like '%'||#{keyword}||'%'
				</when>
				<when test="type == 'W'.toString()">
					writer like '%'||#{keyword}||'%'
				</when>
			</choose>
		  </trim>
	    </foreach>
	  </trim>
	</sql>
<!-- ===================================================================================== -->

	<select id="selectAllPost" resultType="com.hanulso.domain.PostVO">
		SELECT p.pno, p.content, p.email, p.pdate, m.nickname, m.profile, m.language   
		FROM post p, hello_member m     
		WHERE p.email = m.email
		ORDER BY p.pno DESC
	</select>
		<select id="selectFileByPno" resultType="com.hanulso.domain.PostFileVO">
			SELECT * FROM post_file WHERE pno = #{pno}
		</select>
		<select id="selectReplyByPno" resultType="com.hanulso.domain.PostReplyVO">
			SELECT * FROM post_reply WHERE pno = #{pno}
		</select>
		<select id="selectLikeByPno" resultType="com.hanulso.domain.PostLikeVO">
			SELECT * FROM post_like WHERE pno = #{pno}
		</select>

	<insert id="insertHelloMember">
		insert into hello_member (email,nickname,language,sex,profile) 
		values(#{email},#{nickname},#{language},#{sex},#{profile})
	</insert>

	<insert id="insertPost">
		<selectKey keyProperty="pno" order="BEFORE" resultType="int">
			select post_seq.nextval from dual
		</selectKey>
		insert into post (pno,content,email,pdate) 
		values(#{pno},#{content},#{email},sysdate)
	</insert>

	<select id="maxPno" resultType="int">
		select max(pno) from post where email = #{email}
	</select>

	<insert id="insertPostFile">
		<selectKey keyProperty="fno" order="BEFORE" resultType="int">
			select post_file_seq.nextval from dual
		</selectKey>
		insert into post_file (fno,email,pno,uuid) 
		values(#{fno},#{email},#{pno},#{uuid})
	</insert>


</mapper>
